# 機能仕様書: ログイン認証サービス

**機能ブランチ**: `001-docs-requirements-md`
**作成日**: 2025-10-02
**ステータス**: 草案
**入力**: ユーザー説明: "ログイン認証サービスを作成します。要件は'../docs/requirements.md'に記述してあります。"

## 実行フロー（メイン）
```
1. 入力からユーザー説明を解析
   → 説明: ログイン認証サービスの作成
2. 説明から主要概念を抽出
   → アクター: SaaSアプリケーションのユーザー
   → アクション: ログイン、JWT返却
   → データ: 企業ID、メールアドレス、パスワード、アクセストークン
   → 制約: モックサービス、ハードコーディング、フロントエンド実装、サーバーレス、低コスト
3. 不明確な点をマーク
   → [記載済み]
4. ユーザーシナリオとテストセクションを記入
   → [完了]
5. 機能要件を生成
   → [完了]
6. 主要エンティティを特定
   → [完了]
7. レビューチェックリストを実行
   → 実装詳細を排除し、ビジネス要件に集中
8. 結果: 成功（仕様書はプランニングの準備完了）
```

---

## ⚡ クイックガイドライン
- ✅ ユーザーが何を必要とし、なぜ必要なのかに焦点を当てる
- ❌ 実装方法を避ける（技術スタック、API、コード構造なし）
- 👥 技術者ではなく、ビジネス関係者向けに記述

---


## 明確化

### セッション 2025-10-02
- Q: コールバックURLはどのように認証サービスに渡されますか？ → A: POSTリクエストのボディ
- Q: コールバックURL未提供時の動作 → A: デフォルトURLにリダイレクト
- Q: 入力フィールドが空の場合の処理 → A: 空のフィールドをハイライト表示して入力を促す
- Q: JWTトークンはどのようにコールバックURLに渡されますか？ → A: URLフラグメント（例: #token=eyJ...）
- Q: どの入力値でもログインを成功させますか？ → A: どの入力値でもログイン成功

## ユーザーシナリオとテスト

### 主要ユーザーストーリー
SaaSアプリケーションのユーザーが、ログイン画面から企業ID、メールアドレス、パスワードを入力してログインボタンを押すと、認証トークンを受け取りコールバックURLを通じて元のアプリケーションに戻る。

### 受け入れシナリオ
1. **前提条件** ユーザーがログイン画面にアクセスした状態、**操作** 企業ID、メールアドレス、パスワードを入力してログインボタンを押す、**期待結果** JWTトークンが返却され、コールバックURLにリダイレクトされる
2. **前提条件** ユーザーがログインに成功した状態、**操作** 返却されたJWTトークンのペイロードを確認する、**期待結果** 企業ID、ユーザーID、アクセストークン、アクセストークン有効期限が含まれている
3. **前提条件** アクセストークンが生成された状態、**操作** 有効期限を確認する、**期待結果** デフォルトで24時間後に設定されている

### エッジケース
- コールバックURLが提供されない場合、デフォルトURLにリダイレクトする
- 入力フィールドが空の場合、空のフィールドをハイライト表示して入力を促す（ログインは実行しない）
- JWTが無制限の有効期限を持つことのセキュリティ上の考慮事項は？（モックサービスのため許容される想定）

## 要件

### 機能要件
- **FR-001**: システムは、コールバックURLをPOSTリクエストのボディパラメータとして受け取らなければならない。未提供の場合はデフォルトURLを使用する
- **FR-002**: システムは、ログイン画面に企業ID、メールアドレス、パスワードの入力フィールドを表示しなければならない
- **FR-003**: システムは、ログインボタンを提供しなければならない
- **FR-004**: システムは、ログインボタンが押されたときにハードコードされたJWTトークンを返却しなければならない
- **FR-005**: 返却されるJWTトークンのペイロードには、企業ID、ユーザーID、アクセストークン、アクセストークンの有効期限が含まれていなければならない
- **FR-006**: アクセストークンの有効期限は、デフォルトで24時間に設定されなければならない
- **FR-007**: JWTトークン自体の有効期限は無制限でなければならない
- **FR-008**: システムは、認証後にコールバックURLへリダイレクトし、JWTトークンをURLフラグメント（#token=...）として渡さなければならない
- **FR-009**: システムは、入力フィールド（企業ID、メールアドレス、パスワード）が空の場合、該当フィールドをハイライト表示し、ログインを実行しない
- **FR-010**: システムは、どのような入力値（企業ID、メールアドレス、パスワード）でもログインを成功させる（モックサービスのため認証チェックなし）

### 主要エンティティ
- **ログイン資格情報**: 企業ID、メールアドレス、パスワードを含むユーザー入力データ
- **JWTトークン**: 企業ID、ユーザーID、アクセストークン、アクセストークン有効期限を含むペイロードを持つ認証トークン
- **アクセストークン**: ユーザーのセッションを識別するためのトークン。デフォルト24時間の有効期限を持つ
- **コールバックURL**: 認証成功後にユーザーをリダイレクトする先のURL

---

## レビューと受け入れチェックリスト

### 内容品質
- [x] 実装詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネスニーズに焦点
- [x] 非技術的な関係者向けに記述
- [x] すべての必須セクション完了

### 要件の完全性
- [x] [要明確化]マーカーが残っていない
- [x] 要件はテスト可能で明確
- [x] 成功基準は測定可能
- [x] スコープが明確に定義されている
- [x] 依存関係と前提条件が特定されている

---

## 実行ステータス

- [x] ユーザー説明を解析
- [x] 主要概念を抽出
- [x] 不明確な点をマーク
- [x] ユーザーシナリオを定義
- [x] 要件を生成
- [x] エンティティを特定
- [x] レビューチェックリスト合格（すべての明確化項目が解決済み）

---
